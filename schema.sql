create table
  public.users (
    username text not null,
    first text null,
    last text null,
    id bigint generated by default as identity not null,
    constraint users_pkey primary key (id),
    constraint Users_username_key unique (username),
    constraint users_id_key unique (id)
  ) tablespace pg_default;

create table
  public.events (
    id bigint generated by default as identity not null,
    type text not null,
    name text not null,
    location text not null,
    max_attendees bigint not null,
    start timestamp without time zone not null,
    cancelled boolean not null default false,
    stop timestamp without time zone null,
    constraint Event_pkey primary key (id)
  ) tablespace pg_default;

create table
  public.user_events (
    user_id bigint not null,
    event_id bigint not null,
    constraint user_events_pkey primary key (user_id, event_id),
    constraint user_events_event_id_fkey foreign key (event_id) references events (id),
    constraint user_events_user_id_fkey foreign key (user_id) references users (id)
  ) tablespace pg_default;

create table
  public.event_items (
    event_id bigint not null,
    name text not null,
    type text null,
    requested bigint not null,
    cost bigint not null,
    deleted boolean not null default false,
    approved boolean not null default true,
    constraint event_items_pkey primary key (event_id, name)
  ) tablespace pg_default;

create table
  public.items_ledger (
    username text not null,
    quantity bigint not null,
    payment bigint not null,
    event_id bigint not null,
    item_name text not null,
    deleted boolean not null default false,
    constraint items_ledger_pkey primary key (username, event_id, item_name),
    constraint item_ledger_event_id_item_name_fkey foreign key (event_id, item_name) references event_items (event_id, name),
    constraint item_ledger_username_fkey foreign key (username) references users (username)
  ) tablespace pg_default;

create table
  public.games (
    id bigint generated by default as identity not null,
    name text not null,
    platform text not null,
    publisher text not null,
    release_year bigint not null,
    player_count bigint not null,
    constraint games_pkey primary key (
      id,
      name,
      platform,
      publisher,
      release_year,
      player_count
    )
  ) tablespace pg_default;

create table
  public.brackets_old (
    id bigint generated by default as identity not null,
    name text null,
    active text null,
    game text null,
    capacity bigint null,
    date_time timestamp without time zone null,
    cost bigint null,
    event_id bigint null,
    constraint brackets_pkey primary key (id),
    constraint brackets_event_id_fkey foreign key (event_id) references events (id)
  ) tablespace pg_default;

create table
  public.matches (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone not null default now(),
    team_a_score smallint null,
    team_b_score smallint null,
    bracket_id bigint null,
    team_a_id bigint null,
    team_b_id bigint null,
    win_team_id bigint null,
    constraint matches_3 ? _pkey primary key (id),
    constraint matches_3 ? _bracket_id_fkey foreign key (bracket_id) references brackets_old (id) on delete cascade,
    constraint matches_team_a_id_fkey foreign key (team_a_id) references teams (id) on delete cascade,
    constraint matches_team_b_id_fkey foreign key (team_b_id) references teams (id) on delete cascade,
    constraint matches_win_team_id_fkey foreign key (win_team_id) references teams (id) on delete cascade
  ) tablespace pg_default;

create table
  public.match_rounds (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone not null default now(),
    match_id bigint not null,
    team_a_id bigint not null,
    team_b_id bigint not null,
    constraint match_rounds_pkey primary key (id),
    constraint match_rounds_match_id_fkey foreign key (match_id) references matches (id) on delete cascade,
    constraint match_rounds_team_a_id_fkey foreign key (team_a_id) references teams (id) on delete cascade,
    constraint match_rounds_team_b_id_fkey foreign key (team_b_id) references teams (id) on delete cascade
  ) tablespace pg_default;

create table
  public.match_knockouts (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone not null default now(),
    match_id bigint not null,
    winner_a_id bigint not null,
    winner_b_id bigint not null,
    constraint match_knockouts_pkey primary key (id),
    constraint match_knockouts_match_id_fkey foreign key (match_id) references matches (id) on delete cascade,
    constraint match_knockouts_winner_a_id_fkey1 foreign key (winner_a_id) references teams (id) on delete cascade,
    constraint match_knockouts_winner_b_id_fkey foreign key (winner_b_id) references teams (id) on delete cascade
  ) tablespace pg_default;

create table
  public.teams (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone not null default now(),
    team_name text not null,
    bracket_id bigint null,
    constraint teams_pkey primary key (id),
    constraint teams_team_name_key unique (team_name),
    constraint teams_bracket_id_fkey foreign key (bracket_id) references brackets_old (id) on delete cascade
  ) tablespace pg_default;

create table
  public.players (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone not null default now(),
    slot_id bigint null,
    user_id bigint null,
    constraint players_pkey primary key (id),
    constraint players_user_id_fkey foreign key (user_id) references users (id)
  ) tablespace pg_default;